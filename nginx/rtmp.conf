# Add this block at the END of /etc/nginx/nginx.conf
# It must be at the top level, OUTSIDE the http {} block.

rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        application live {
            live on;
            record off;

            # Auth callback â€” the C++ backend validates the stream key
            on_publish http://127.0.0.1:8085/api/auth;
            on_publish_done http://127.0.0.1:8085/api/streams/stream/publish_done;

            # HLS output
            hls on;
            hls_path /var/www/hls;
            hls_fragment 3s;
            hls_playlist_length 60s;
            hls_cleanup on;

            # Only allow HLS playback, not RTMP pull
            deny play all;
        }
    }
}
